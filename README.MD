
# ‚úÖ Validador de Dados - ERP Director

Ferramenta para **valida√ß√£o automatizada de dados** entre sistemas legados (Firebird, MySQL, SQL Server) e o banco de destino **SQL Server (ERP Director)**.  
Desenvolvida para acelerar a valida√ß√£o de dados durante implanta√ß√µes, com foco em consist√™ncia, agilidade e rastreabilidade.

---

## ‚öôÔ∏è Principais Funcionalidades

- üîó Valida√ß√£o entre diferentes tipos de bancos: Firebird, MySQL e SQL Server
- üìÑ Regras de valida√ß√£o externas em arquivos `.json`, com suporte a l√≥gica condicional e normaliza√ß√£o de dados
- üìä Compara√ß√£o din√¢mica e linha a linha dos dados (ex: CNPJ, IE, Nome, Data Inativa√ß√£o)
- üì• Exporta√ß√£o autom√°tica para Google Sheets + gera√ß√£o de relat√≥rios locais em `.xlsx` e `.csv`
- üí° Interface gr√°fica simples para selecionar pipeline e regras
- üì¶ Modular e escal√°vel para m√∫ltiplas entidades (clientes, produtos, fornecedores, etc.)

---

## üß† Altera√ß√µes e Melhorias Recentes

- ‚úÖ Ordena√ß√£o inteligente dos resultados (com base na chave prim√°ria e ordem dos campos no JSON)
- ‚úÖ Separa√ß√£o total entre normaliza√ß√£o e compara√ß√£o
- ‚úÖ Aplica√ß√£o autom√°tica de normalizadores definidos nas regras
- ‚úÖ Interface din√¢mica para escolha de pipeline + JSON
- ‚úÖ Suporte √† gera√ß√£o de regras via planilha

---

## üìÅ Estrutura do Projeto

```text
validacao_dados/
‚îÇ   interface.py
‚îÇ   main.py
‚îÇ   run_validador.bat
‚îÇ   Rodar_regras_json.bat
‚îÇ   README.md
‚îÇ   requirements.txt
‚îú‚îÄ‚îÄ assets/
‚îú‚îÄ‚îÄ config/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ connectors/
‚îÇ   ‚îú‚îÄ‚îÄ pipelines/
‚îÇ   ‚îú‚îÄ‚îÄ reports/
‚îÇ   ‚îî‚îÄ‚îÄ validator.py
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ input/
‚îÇ   ‚îî‚îÄ‚îÄ output/
‚îÇ       ‚îî‚îÄ‚îÄ jsons/
‚îú‚îÄ‚îÄ rules/
‚îî‚îÄ‚îÄ utils/
```

---

## üîÑ Fluxo de Valida√ß√£o

```mermaid
graph TD
    A[run_validador.bat] --> B[interface.py]
    B --> C[Seleciona pipeline e JSON]
    C --> D[Executa pipeline ex: firebird_to_sql]
    D --> E[Busca dados dos bancos]
    E --> F[Carrega regras do JSON]
    F --> G[Aplica normalizadores e comparadores]
    G --> H[Valida campo a campo - validator.py]
    H --> I[Exporta Google Sheets e .xlsx/.csv]
```

---

## üß© Componentes do Projeto

| Componente                          | Fun√ß√£o                                                                 |
|------------------------------------|------------------------------------------------------------------------|
| `run_validador.bat`                | Inicia a interface gr√°fica                                             |
| `interface.py`                     | Interface visual (sele√ß√£o de pipeline, JSON, log)                     |
| `main.py`                          | Execu√ß√£o via terminal                                                  |
| `core/validator.py`                | L√≥gica de valida√ß√£o linha a linha                                      |
| `core/pipelines/*.py`              | Pipelines por tipo de origem                                           |
| `core/connectors/*.py`             | Conectores com Firebird, MySQL, SQL Server                            |
| `core/reports/google_sheets.py`    | Exporta para Google Sheets                                             |
| `rules/*.json`                     | Regras de valida√ß√£o externas                                           |
| `data/input/`                      | Templates de planilha para regras                                      |
| `data/output/`                     | Resultados `.csv` e `.xlsx`                                            |
| `utils/gerar_jsons_de_planilha.py`| Gera JSON a partir de planilha Excel                                   |
| `config/`                          | Credenciais e settings                                                 |
| `assets/icone.ico`                 | √çcone para vers√£o `.exe`                                               |

---

## üë£ Como Usar

### üõ†Ô∏è 1. Preparar o Ambiente (primeira vez)

```powershell
# Crie a pasta onde quiser
cd "C:\Users\SeuUsuario\Documents\validacao_dados"

# Crie o ambiente virtual
python -m venv .venv

# Ative o ambiente
.venv\Scripts\Activate.ps1

# Caso d√™ erro de permiss√£o
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser

# Instale as depend√™ncias
pip install -r requirements.txt
```

Para desativar o ambiente:
```powershell
deactivate
```

---

### üìÑ 2. Preparar Regras

- Edite ou crie o JSON em `rules/` ou `data/output/jsons/`
- Use o Excel `template_regras_clientes.xlsx` para montar visualmente
- Execute o script `utils/gerar_jsons_de_planilha.py` para gerar os arquivos

---

### üöÄ 3. Executar Valida√ß√£o

#### ‚úÖ Via Interface

1. Clique duplo em `Iniciar_Validador.bat`
2. Escolha pipeline e JSON
3. Clique em **Executar Valida√ß√£o**
4. Veja o log ao vivo na interface

#### ‚öôÔ∏è Via Terminal

```bash
python main.py firebird_to_sql regras_clientes.json
```

---

### üìä 4. Ver Resultados

- Arquivos `.xlsx` e `.csv` salvos em `data/output/`
- Resultado tamb√©m enviado para o Google Sheets:  
üîó [Abrir planilha](https://docs.google.com/spreadsheets/d/16u8KSsLNidNtlZ4daX2Vs-GALqgM7OvESHRpGB9VUI8)

---

### ‚ôªÔ∏è 5. Reutilizar

- Para validar outro conjunto de regras, basta trocar o `.json` e executar novamente

---

## üß¨ Exemplo de Regra `.json`

```json
{
  "entidade": "cliente",
  "primary_key": ["DFcod_cliente", "CHAVEPES"],
  "campos": [
    {
      "destino": "DFnome",
      "origem": "NOME",
      "normalizar": "true"
    },
    {
      "destino": "DFcnpj_cpf",
      "origem": ["CNPJ", "CPF"],
      "condicao": {
        "coluna": "TIPOFISCAL",
        "valores": {
          "F": "CPF",
          "J": "CNPJ"
        }
      },
      "normalizar": "documento"
    },
    {
      "destino": "DFinscr_estadual",
      "origem": "IE",
      "normalizar": "true"
    },
    {
      "destino": "DFdata_inativacao",
      "origem": "DATADESATIVADO",
      "normalizar": "true"
    }
  ]
}
```

---

## üîê Seguran√ßa

- Credenciais est√£o em `config/credentials.py` e `config/google_credentials.json`
- ‚ö†Ô∏è Nunca suba essas informa√ß√µes para reposit√≥rios p√∫blicos

---

## üîß Expans√£o e Manuten√ß√£o

### Adicionar nova entidade

1. Crie um novo `.json` em `rules/`
2. Se necess√°rio, adicione pipeline em `core/pipelines/`
3. Execute pela interface

### Gerar regras por planilha

- Use `utils/gerar_jsons_de_planilha.py`
- Baseie-se no template em `data/input/`

---

## ‚úÖ Observa√ß√µes Finais

- Banco de destino sempre ser√° SQL Server
- Interface exibe logs ao vivo
- Campos divergentes recebem status `Divergente`
- Relat√≥rios incluem totais
- Suporte a m√∫ltiplas entidades e novas regras
