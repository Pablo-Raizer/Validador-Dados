# ‚úÖ Validador de Dados - ERP Director

Ferramenta para **valida√ß√£o automatizada de dados** entre sistemas legados (Firebird, MySQL, SQL Server) e o banco de destino **SQL Server (ERP Director)**.  
Desenvolvida para acelerar a valida√ß√£o de dados durante implanta√ß√µes, com foco em consist√™ncia, agilidade e rastreabilidade.

---

## ‚öôÔ∏è Principais Funcionalidades

- üîó Valida√ß√£o entre diferentes tipos de bancos: Firebird, MySQL e SQL Server
- üìÑ Regras de valida√ß√£o externas em arquivos `.json`, com suporte a l√≥gica condicional e normaliza√ß√£o de dados
- üìä Compara√ß√£o din√¢mica e linha a linha dos dados (ex: CNPJ, IE, Nome, Data Inativa√ß√£o)
- üì• Exporta√ß√£o autom√°tica para Google Sheets + gera√ß√£o de relat√≥rios locais em `.xlsx` e `.csv`
- üí° Interface gr√°fica simples para selecionar pipeline e regras
- üì¶ Modular e escal√°vel para m√∫ltiplas entidades (clientes, produtos, fornecedores, etc.)

---

## üß† Altera√ß√µes e Melhorias Recentes

- ‚úÖ **Ordena√ß√£o inteligente dos resultados**: agora baseada na chave prim√°ria (`CODIGO`) e respeita a ordem dos campos definidos no JSON
- ‚úÖ **Separa√ß√£o total entre normaliza√ß√£o e compara√ß√£o**: os comparadores agora n√£o fazem mais normaliza√ß√µes internas
- ‚úÖ **Aplica√ß√£o autom√°tica de normalizadores** com base nos campos definidos no JSON
- ‚úÖ **Pipeline atualizado** para garantir que a ordena√ß√£o dos resultados respeite a estrutura declarada nas regras
- ‚úÖ **Interface din√¢mica**: usu√°rio escolhe pipeline e JSON diretamente pela interface
- ‚úÖ **Gera√ß√£o de regras via planilha** com script auxiliar (`gerar_jsons_de_planilha.py`)

---

## üìÅ Estrutura do Projeto

```
validacao_dados/
‚îÇ   interface.py               # Interface gr√°fica
‚îÇ   main.py                    # Executor de pipeline via terminal
‚îÇ   run_validador.bat          # Atalho para iniciar a interface
‚îÇ   Rodar_regras_json.bat      # Atalho para executar com JSON direto
‚îÇ   README.md                  # Este documento
‚îÇ   requirements.txt           # Depend√™ncias do projeto
‚îÇ
‚îú‚îÄ‚îÄ assets/                    # √çcone usado no execut√°vel
‚îú‚îÄ‚îÄ config/                    # Credenciais e configura√ß√µes globais
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ connectors/            # Firebird, MySQL e SQL Server
‚îÇ   ‚îú‚îÄ‚îÄ pipelines/             # L√≥gica de execu√ß√£o por tipo de origem
‚îÇ   ‚îú‚îÄ‚îÄ reports/               # Exporta√ß√£o para Google Sheets
‚îÇ   ‚îî‚îÄ‚îÄ validator.py           # Validador principal
‚îÇ
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ input/                 # Planilhas para gerar regras
‚îÇ   ‚îî‚îÄ‚îÄ output/                # Arquivos de sa√≠da (CSV/XLSX)
‚îÇ       ‚îî‚îÄ‚îÄ jsons/             # Regras geradas a partir da planilha
‚îÇ
‚îú‚îÄ‚îÄ rules/                     # Regras de valida√ß√£o em JSON
‚îî‚îÄ‚îÄ utils/                     # Scripts auxiliares (gera√ß√£o de JSONs)
```

---

## üîÑ Fluxo de Valida√ß√£o

```mermaid
graph TD
    A[run_validador.bat] --> B[interface.py (GUI)]
    B --> C[Usu√°rio escolhe pipeline + JSON de regras]
    C --> D[Executa pipeline (ex: firebird_to_sql)]
    D --> E[Conectores buscam dados dos bancos]
    E --> F[Carrega regras do JSON escolhido]
    F --> G[Aplica normalizadores e comparadores do JSON]
    G --> H[Valida√ß√£o campo a campo (core/validator.py)]
    H --> I[Exporta√ß√£o autom√°tica Google Sheets + .xlsx/.csv]
```

---
## üß© Componentes do Projeto (Vis√£o Geral)

| Componente                          | Fun√ß√£o                                                                 |
| ---------------------------------- | ---------------------------------------------------------------------- |
| `run_validador.bat`                | Inicia a interface gr√°fica com duplo clique                            |
| `interface.py`                     | Interface visual: sele√ß√£o de pipeline, escolha de regras e log ao vivo |
| `main.py`                          | Executa o validador direto via terminal com um JSON de regras          |
| `core/validator.py`                | Aplica a l√≥gica de compara√ß√£o linha a linha com base nas regras JSON   |
| `core/pipelines/*.py`              | Scripts que orquestram conex√£o, leitura de dados e execu√ß√£o da valida√ß√£o |
| `core/connectors/*.py`             | Conex√£o com bancos Firebird, MySQL, SQL Server                         |
| `core/reports/google_sheets.py`    | Envia automaticamente os resultados para o Google Sheets               |
| `rules/*.json`                     | Arquivos com regras de valida√ß√£o (campos, condi√ß√µes, mapeamentos)      |
| `data/input/`                      | Templates de planilha para gerar JSONs                                 |
| `data/output/`                     | Exporta arquivos `.csv` e `.xlsx` com os resultados da valida√ß√£o       |
| `utils/gerar_jsons_de_planilha.py`| Script que converte planilha Excel em regras JSON                      |
| `config/`                          | Cont√©m credenciais, configura√ß√µes globais e arquivos sens√≠veis         |
| `assets/icone.ico`                 | √çcone usado na vers√£o `.exe`                                           |

---

üë£ Como Usar ‚Äì Passo a Passo R√°pido
üõ†Ô∏è 1. Prepare o ambiente (executar no PowerShell como administrador)- S√≥ na primeira vez

# Crie a pasta do projeto (onde quiser)

C:\validacao_dados

# No PowerShell localize a pasta do projeto

cd "C:\Users\SeuUsuario\Documents\validacao_dados"

# Crie o ambiente virtual
python -m venv .venv

# Ative o ambiente virtual no PowerShell
.venv\Scripts\Activate.ps1

# (‚ö†Ô∏è Caso apare√ßa erro de permiss√£o, execute isso e tente ativar de novo:)
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser

# Instale as depend√™ncias do projeto
pip install -r requirements.txt

# Para desativar o ambiente virtual quando terminar:

deactivate

---

### üß† 2. Prepare suas regras de valida√ß√£o

- Crie ou edite o `.json` dentro da pasta `rules/` ou `data/output/jsons/`
- Use a planilha `template_regras_clientes.xlsx` (em `data/input/`) para montar visualmente
- Execute o script `utils/gerar_jsons_de_planilha.py` para gerar os arquivos JSON automaticamente

---

### üéØ 3. Execute a Valida√ß√£o

Voc√™ pode rodar de dois jeitos:

#### ‚úÖ Via Interface Gr√°fica

1. **Clique duplo** em `Iniciar_Validador.bat`
2. Escolha o pipeline desejado (ex: Firebird ‚Üí SQL Server)
3. Selecione o arquivo `.json` com as regras
4. Clique em **"Executar Valida√ß√£o"**
5. Acompanhe o log da execu√ß√£o em tempo real

---

#### ‚öôÔ∏è Via Terminal

```bash
python main.py firebird_to_sql regras_clientes.json
```

---

### üìä 4. Veja os Resultados

- Os arquivos `.xlsx` e `.csv` s√£o salvos em `data/output/`
- Resultado tamb√©m √© enviado automaticamente para o Google Sheets  
  üîó [Acessar Planilha](https://docs.google.com/spreadsheets/d/16u8KSsLNidNtlZ4daX2Vs-GALqgM7OvESHRpGB9VUI8)

---

### üîÑ 5. Reaproveitar? S√≥ trocar o JSON e executar de novo

---
## üìã Exemplo de Regra JSON

```json
{
  "entidade": "cliente",
  "primary_key": ["DFcod_cliente", "CHAVEPES"],
  "campos": [
    {
      "destino": "DFnome",
      "origem": "NOME",
      "normalizar": "texto_simples"
    },
    {
      "destino": "DFcnpj_cpf",
      "origem": ["CNPJ", "CPF"],
      "condicao": {
        "coluna": "TIPOFISCAL",
        "valores": {
          "F": "CPF",
          "J": "CNPJ"
        }
      },
      "normalizar": "documento"
    },
    {
      "destino": "DFinscr_estadual",
      "origem": "IE",
      "normalizar": "texto_simples"
    },
    {
      "destino": "DFdata_inativacao",
      "origem": "DATADESATIVADO",
      "normalizar": "data_sem_hora"
    }
  ]
}
```

---

## üîê Seguran√ßa

- üîí As credenciais est√£o armazenadas em `config/google_credentials.json` e `config/credentials.py`
- ‚ö†Ô∏è Nunca subir essas informa√ß√µes para reposit√≥rios p√∫blicos


---

## üì¶ Expans√£o e Manuten√ß√£o

### Adicionar nova entidade:
1. Crie um novo arquivo de regras em `rules/`
2. Se necess√°rio, crie um novo pipeline em `core/pipelines/`
3. Execute pela interface e selecione a nova regra

### Gerar regras a partir de planilha:
Use o script `utils/gerar_jsons_de_planilha.py` com o template em `data/input/`

---

## ‚úÖ Observa√ß√µes Finais

- Banco de destino sempre ser√° SQL Server
- Interface exibe logs ao vivo
- Campos divergentes recebem status `Divergente`
- Relat√≥rio inclui resumo com totais de ativos/inativos
- Suporte a expans√£o futura para entidades adicionais
---

